"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 22.5), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Median counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
sprintf("%.6s", c(err_uncomped, paste(round(rowSums(comped^2)/ncol(comped), 4))))
paste((err_uncomped, paste(round(rowSums(comped^2)/ncol(comped), 4))))
paste(err_uncomped, paste(round(rowSums(comped^2)/ncol(comped), 4))))
paste(err_uncomped, round(rowSums(comped^2)/ncol(comped), 4))
sprintf("%.6s", c(err_uncomped, round(rowSums(comped^2)/ncol(comped), 4)))
err_uncomped <- round(sum(uncomped^2)/length(uncomped), 4)
sprintf("%.6s", c(err_uncomped, round(rowSums(comped^2)/ncol(comped), 4)))
rowSums(comped^2)
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.6s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3)))
z=round(colSums(medians_ssbeads^2)/nrow(medians_ssbeads), 5)))
sprintf("%.6s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3)))
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3)))
err_zero <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(zero^2)/ncol(zero), nsmall=3)))
rect <- data.frame(x1=0, x2=nrow(err_comped), y1=19, y2=21)
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_medians.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.5, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 22.5), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Median counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
n <- length(means)
df <- data.frame(x=rep(1:3,each=n), y=c(means, means_c, means_c_0), col=rep(1:3,each=n))
df$x <- df$x + rnorm(nrow(df), sd=.125)
p <- ggplot(df) + theme_classic() + labs(x=NULL, y="Mean counts") +
geom_hline(aes(yintercept=0), lty=2, size=.5) + ggtitle(nm) +
geom_point(aes(x=x, y=y, col=as.factor(col)), alpha=.4, size=2) +
theme(axis.text.x=element_text(angle=45, hjust=1, vjust=1)) +
scale_colour_discrete(labels=c("Uncompensated", "Compensated", "Compensated set to zero"), name=NULL) +
guides(color=guide_legend(override.aes=list(alpha=1))) +
scale_x_continuous(limits=c(0,4), breaks=NULL) +
scale_y_continuous(limits=c(-12, 32), breaks=seq(-12, 32, 4))
pdf(paste0("/Users/HLC/Desktop/", nm, ".pdf"), width=8, height=8)
p; dev.off()
----
err_uncomped <- round(sum(uncomped^2)/length(uncomped), 4)
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3))))
err_zero <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(zero^2)/ncol(zero), nsmall=3))))
rect <- data.frame(x1=0, x2=nrow(err_comped), y1=19, y2=21)
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_medians.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.5, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 22.5), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Median counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
# uncompensated ----
uncomped <- c(
unlist(sapply(seq_along(ms_even), function(i) {
cols <- spillCols[[which(ms == ms_even[i])]]
cols <- cols[!ms[cols] %in% ex_even]
cols <- cols[!ms[cols] > 176]
if (length(cols) != 0) {
if (length(cols) == 1) {
mean(es_even[[i]][, cols])
} else {
colMeans(es_even[[i]][, cols])
}
}
})),
unlist(sapply(seq_along(ms_odd), function(i) {
cols <- spillCols[[which(ms == ms_odd[i])]]
cols <- cols[!ms[cols] %in% ex_odd]
cols <- cols[!ms[cols] > 176]
colMeans(es_odd[[i]][, cols])
if (length(cols) != 0) {
if (length(cols) == 1) {
mean(es_odd[[i]][, cols])
} else {
colMeans(es_odd[[i]][, cols])
}
}
}))
)
# ----
comped <- zero <- data.frame()
for (i in seq_along(ms_even)) {
cols <- spillCols[[which(ms == ms_even[i])]]
cols <- cols[!ms[cols] %in% ex_even]
cols <- cols[!ms[cols] > 176]
if (length(cols) != 0) {
comped <- rbind(comped, do.call(cbind,
lapply(es_even_c[[i]], function (j) {
if (length(cols) == 1) {
mean(j[, cols])
} else {
colMeans(j[, cols])
}
})))
zero <- rbind(zero, do.call(cbind,
lapply(es_even_c_0[[i]], function (j) {
if (length(cols) == 1) {
mean(j[, cols])
} else {
colMeans(j[, cols])
}
})))
}
}
for (i in seq_along(ms_odd)) {
cols <- spillCols[[which(ms == ms_odd[i])]]
cols <- cols[!ms[cols] %in% ex_odd]
cols <- cols[!ms[cols] > 176]
if (length(cols) != 0) {
comped <- rbind(comped, do.call(cbind,
lapply(es_odd_c[[i]], function (j) {
if (length(cols) == 1) {
mean(j[, cols])
} else {
colMeans(j[, cols])
}
})))
zero <- rbind(zero, do.call(cbind,
lapply(es_odd_c_0[[i]], function (j) {
if (length(cols) == 1) {
mean(j[, cols])
} else {
colMeans(j[, cols])
}
})))
}
}
comped <- t(comped); zero <- t(zero)
rownames(comped) <- rownames(zero) <- nms
colnames(comped) <- rep("Compensated", ncol(comped))
colnames(zero) <- rep("Comped. set to 0", ncol(zero))
df_uncomped <- data.frame(Var1=0, Var2="Uncompensated", value=uncomped)
df_comped <- reshape2::melt(comped)
df_zero <- reshape2::melt(zero)
df_comped <- rbind(df_uncomped, df_comped)
df_zero <- rbind(df_uncomped, df_zero)
err_uncomped <- round(sum(uncomped^2)/length(uncomped), 4)
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3))))
err_zero <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(zero^2)/ncol(zero), nsmall=3))))
rect <- data.frame(x1=0, x2=nrow(err_comped), y1=19, y2=21)
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.5, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 22.5), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.25, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 22.5), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
err_uncomped <- round(sum(uncomped^2)/length(uncomped), 4)
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(15, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3))))
err_zero <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(zero^2)/ncol(zero), nsmall=3))))
rect <- data.frame(x1=0, x2=nrow(err_comped), y1=14, y2=16)
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.25, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 17), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
err_uncomped <- round(sum(uncomped^2)/length(uncomped), 4)
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(12, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3))))
err_zero <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(zero^2)/ncol(zero), nsmall=3))))
rect <- data.frame(x1=0, x2=nrow(err_comped), y1=14, y2=16)
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.25, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 17), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
err_uncomped <- round(sum(uncomped^2)/length(uncomped), 4)
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(12.5, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3))))
err_zero <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(zero^2)/ncol(zero), nsmall=3))))
rect <- data.frame(x1=0, x2=nrow(err_comped), y1=14, y2=16)
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.25, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 17), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.25, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 18), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.25, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 20), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
err_uncomped <- round(sum(uncomped^2)/length(uncomped), 4)
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(22.5, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3))))
err_zero <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(zero^2)/ncol(zero), nsmall=3))))
rect <- data.frame(x1=0, x2=nrow(err_comped), y1=21, y2=24)
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.25, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 25), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
err_uncomped <- round(sum(uncomped^2)/length(uncomped), 4)
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(22.5, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3))))
err_zero <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(zero^2)/ncol(zero), nsmall=3))))
rect <- data.frame(x1=0, x2=nrow(err_comped), y1=21.5, y2=23.5)
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.25, size=1.5, stroke=.25) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 25), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
err_uncomped <- round(sum(uncomped^2)/length(uncomped), 4)
err_comped <- data.frame(x=unique(df_comped$Var1), y=rep(22.5, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(comped^2)/ncol(comped), nsmall=3))))
err_zero <- data.frame(x=unique(df_comped$Var1), y=rep(20, length(sm)+1),
z=sprintf("%.5s", c(err_uncomped, format(rowSums(zero^2)/ncol(zero), nsmall=3))))
rect <- data.frame(x1=0, x2=nrow(err_comped), y1=21.5, y2=23.5)
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.25, size=1.5, stroke=.5) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 25), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.3, size=1.5, stroke=.3) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 25), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.3, size=1.5, stroke=.3) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 25), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
pdf(file.path(path, "Gadolin_mpbeads_comped_w_12_CMs_means.pdf"), 6, 8)
ggplot(df_comped) +
geom_vline(xintercept=12, lty=2, size=.5) +
geom_hline(yintercept=0, lty=3, size=.5) +
geom_jitter(aes(x=as.factor(Var1), y=value, color=as.factor(Var1)),
width=.2, alpha=.3, size=1.5, stroke=.3) +
guides(colour=guide_legend(name=NULL, override.aes=list(alpha=1))) +
scale_color_manual(values=palette) +
geom_rect(fill="white", inherit.aes=FALSE, data=rect,
aes_string(xmin="x1", xmax="x2", ymin="y1", ymax="y2")) +
geom_text(inherit.aes=FALSE, data=err_comped, angle=90, size=3, vjust=.5,
aes(x=as.factor(x), y=y, label=z)) +
scale_x_discrete(limits=c(0, nms[c(1:8, 10, 9, 11:12)]),
labels=c("Uncompensated", "Comped. M0", "Comped. M2",
"Comped. M4-D1-1", "Comped. M4-D1-2", "Comped. M4-D1-3", "Comped. M4-D2", "Comped. M4-D3",
"Facility D0", "Facility D7", "Gadolin D0", "Gadolin D7", "Fluidigm")) +
scale_y_continuous(limits=c(-2.5, 25), breaks=seq(-20, 50, 10), expand=c(0,0)) +
theme_classic() + labs(x=NULL, y="Mean counts upon compensation") +
theme(legend.position="none",
axis.text.x=element_text(angle=30, vjust=1, hjust=1, color="black"),
axis.text.y=element_text(color="black"),
panel.grid.major.x=element_line(size=.25, color="lightgrey"))
dev.off()
